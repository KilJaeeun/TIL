# 2장. 빅데이터의 탐색

> * 2.1 절에서는 크로스 집계의 개념을 설명한다.모든 스프레드 시트의 피벗테이블의 기능을 BI도구와 SQL, 그리고 파이썬에서 집계하는 방법에 대해 설명한다.
> * 열 지향스토리지
> * 대량의 데이터를 압축해서, 분산하고 그것을  다수의  CPU 코어로 집계하는 MPP 데이터베이스 구조도 설명한다.
> * 툴(대화형 데이터 분석을 위한 노트북, 정기적 그래프를 업데이트하는 대시보드 도구, 대화형 대시보드를 위한 BI도구)
> * 데이터마트 설계
>
> * BI 도구에는 OLAP 라는 데이터 분석 개념이 도입되며, 그에 적합한 비정규화 테이블을 만들어 데이터를 쉽게 시각화할 수 있다.



## 2-1. 크로스 집계의 기본

데이터 시각화에서 기본이 되는 것은 "크로스 집계"이다. 



### 트랜잭션 테이블, 크로스 테이블, 피봇 테이블

> 크로스 집계의 개념



* 크로스 테이블: 행과 열이 교차하는 부분에 숫자 데이터가 들어간다., 행+ 열 동시 증가
* 트랜잭션 테이블: 행방향만 증가하고 열 방향으로는 데이터가 증가하지 않게 해야함.
* 크로스 집계(cross tablulation): 트랜잭션 테이블에서 크로스 테이블로 변환하는 과정
  * 소령의 데이터를 크로스 집계하는데 편리한 것이 스프레드 시트의 "피벗테이블"이다. 



#### 피벗테이블 기능에 의한 크로스 집계

엑셀 피벗 테이블 말하는 것. 그냥 엑셀 공부해보면 바로 아는데 난 이미 할 줄 안다.

* 데이터 다각적으로 집계 가능
* 평균 , 최댓값, 이전 현재 차이 등을 계산할 수 있다.
* 피벗 테이블의 행과 열을 설정하는 항목을 바꿈으로 써 자신이 관심있는 항목에 대한 집꼐 결과를 즉시 얻을 수 있다.
* 이것을 그래프화 하면 -> 피벗 그래프
*  고로 크로스 집계는 데이터 시각화 기초





### 룩업 테이블

> 테이블을 결합해 속성 늘리기

* 다른 테이블과 결합하고 싶을때 룩업 테이블 사용한다.



#### BI도구에 의한 크로스 집계

생략. 조인 계산임

#### Pandas에 의한 크로스 집계

스크립트로 크로스 집계를 실행하고 싶다면 pandas를 이용하는 것이 편리하다. 2개의 테이블을 결합하려면 `merge()`를 실행한다.

```python
import pandas as pd  # 트랜잭션 테이블 로드

df1= pd.read_excel(u'판매데이터.xlsx',u'판매이력') # 룩업 테이블 로드
df2= pd.read_excel(u'판매데이터.xlsx',u'상품') # 테이블 결합하기
df3= pd.merge(df1. df2. on=u'상품ID')
```

예상대로 칼럼이 추가되어 이것을 `pivot_table`로 크로스 집계한다.

Pandas에서 데이터 프레임만 만들 수 있다면, 어떤 데이터라도 결합할 수 있다. read_csv()에서 csv파일을 로드하거나 `read_clipboard()` 로 클립보드로부터 복사할 수 있다. 아니면, 스크립트에서 동적으로 컬럼을 만들 수도 있다. 

```python
# 독자적으로 정의한 파이썬 함수로 상품 카테고리 생성

# 상품 카테고리를 함수로 설정
def category(row):
	return {101:u'식료품'}.get(row[u'상품ID'], u'그 외')
df1[u'상품 카테고리']=df1.apply(category, axis=1)
```


